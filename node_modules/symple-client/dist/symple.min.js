!function(a){a.parseAddress=function(a){var b={},c=a.split("|");return c.length>0&&(b.user=c[0]),c.length>1&&(b.id=c[1]),b},a.buildAddress=function(a){return(a.user?a.user+"|":"")+(a.id?a.id:"")},a.filterObject=function(b,c,d){var e=[];for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];if(c&&f!==c||d&&g!==d){if("object"==typeof g){var h=a.filterObject(g,c,d);h&&(e=e.concat(h))}}else e.push(b)}return e},a.deleteNested=function(b,c,d){for(var e in b){var f=b[e];c&&e!==c||d&&f!==d?"object"==typeof f&&a.deleteNested(f,c):delete b[e]}},a.countNested=function(b,c,d,e){void 0===e&&(e=0);for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];c&&f!==c||d&&g!==d?"object"==typeof g&&(e=a.countNested(g,c,d,e)):e++}return e},a.traverse=function(b,c){for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];c(d,e),"object"==typeof e&&a.traverse(e,c)}},a.randomString=function(a){return Math.random().toString(36).slice(2)},a.merge=function(a,b){for(var c in b)try{b[c].constructor===Object?a[c]=merge(a[c],b[c]):a[c]=b[c]}catch(d){a[c]=b[c]}return a},a.extend=function(){for(var a=function(a,b){for(var c in b)hasOwnProperty.call(b,c)&&(a[c]=b[c]);return a},b=arguments[0],c=1;c<arguments.length;c++)b=a(b,arguments[c]);return b},a.runVendorMethod=function(a,b){for(var c,d,e=0,f=["webkit","moz","ms","o",""];e<f.length&&!a[c];){if(c=b,""===f[e]&&(c=c.substr(0,1).toLowerCase()+c.substr(1)),c=f[e]+c,d=typeof a[c],"undefined"!==d)return f=[f[e]],"function"===d?a[c]():a[c];e++}},a.parseISODate=function(a){var b=Date.parse(a);if(isNaN(b)){var c,d=0,e=[1,4,5,6,7,10,11];if(c=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(a)){for(var f,g=0;f=e[g];++g)c[f]=+c[f]||0;c[2]=(+c[2]||1)-1,c[3]=+c[3]||1,"Z"!==c[8]&&void 0!==c[9]&&(d=60*c[10]+c[11],"+"===c[9]&&(d=0-d)),b=Date.UTC(c[1],c[2],c[3],c[4],c[5]+d,c[6],c[7])}}return new Date(b)},a.isMobileDevice=function(){return"ontouchstart"in document.documentElement},a.iOSVersion=function(a,b){return parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1},a.match=function(a,b){var c=!0;for(var d in a)if(!a.hasOwnProperty(d)||!b.hasOwnProperty(d)||b[d]!==a[d]){c=!1;break}return c},a.formatTime=function(a){function b(a){return 10>a?"0"+a:a}return b(a.getHours()).toString()+":"+b(a.getMinutes()).toString()+":"+b(a.getSeconds()).toString()+" "+b(a.getDate()).toString()+"/"+b(a.getMonth()).toString()},a.hasClass=function(a,b){return-1!==(" "+a.className+" ").indexOf(" "+b+" ")},a.log=function(){"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(console,arguments)};var b=!1,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;a.Class=function(){},a.Class.extend=function(a){function d(){!b&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;b=!0;var f=new this;b=!1;for(var g in a)f[g]="function"==typeof a[g]&&"function"==typeof e[g]&&c.test(a[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,a[g]):a[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d},a.Emitter=a.Class.extend({init:function(){this.listeners={}},on:function(a,b){"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]),"undefined"!=typeof b&&b.constructor===Function&&this.listeners[a].push(b)},clear:function(a,b){if("undefined"!=typeof this.listeners[a])for(var c=0;c<this.listeners[a].length;c++)this.listeners[a][c]===b&&this.listeners[a].splice(c,1)},emit:function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);if("undefined"!=typeof this.listeners[a])for(var c=0;c<this.listeners[a].length;c++)this.listeners[a][c].constructor===Function&&this.listeners[a][c].apply(this,b)}}),a.Manager=a.Class.extend({init:function(a){this.options=a||{},this.key=this.options.key||"id",this.store=[]},add:function(a){this.store.push(a)},remove:function(a){for(var b=null,c=0;c<this.store.length;c++)if(this.store[c][this.key]===a){b=this.store[c],this.store.splice(c,1);break}return b},get:function(a){for(var b=0;b<this.store.length;b++)if(this.store[b][this.key]===a)return this.store[b];return null},find:function(b){for(var c=[],d=0;d<this.store.length;d++)a.match(b,this.store[d])&&c.push(this.store[d]);return c},findOne:function(a){var b=this.find(a);return b.length?b[0]:void 0},last:function(){return this.store[this.store.length-1]},size:function(){return this.store.length}})}(window.Symple=window.Symple||{}),function(a){a.Client=a.Emitter.extend({init:function(b){this.options=a.extend({url:b.url?b.url:"http://localhost:4000",secure:!(!b.url||0!==b.url.indexOf("https")&&0!==b.url.indexOf("wss")),token:void 0},b),this._super(),this.peer=b.peer||{},this.peer.rooms=b.peer.rooms||[],this.roster=new a.Roster(this),this.socket=null},connect:function(){if(a.log("symple:client: connecting",this.options),self=this,this.socket)throw"The client socket is not null";var b=b||window.io;this.socket=b.connect(this.options.url,this.options),this.socket.on("connect",function(){a.log("symple:client: connected"),self.socket.emit("announce",{token:self.options.token||"",user:self.peer.user||"",name:self.peer.name||"",type:self.peer.type||""},function(b){return a.log("symple:client: announced",b),200!==b.status?void self.setError("auth",b):(self.peer=a.extend(self.peer,b.data),self.roster.add(b.data),self.sendPresence({probe:!0}),self.emit("announce",b),void self.socket.on("message",function(b){if("object"==typeof b){switch(b.type){case"message":b=new a.Message(b);break;case"command":b=new a.Command(b);break;case"event":b=new a.Event(b);break;case"presence":b=new a.Presence(b),b.data.online?self.roster.update(b.data):setTimeout(function(){self.roster.remove(b.data.id)}),b.probe&&self.sendPresence(new a.Presence({to:a.parseAddress(b.from).id}));break;default:o=b,o.type=o.type||"message"}if("string"!=typeof b.from)return void a.log("symple:client: invalid sender address",b);var c=self.roster.get(b.from);c?b.from=c:a.log("symple:client: got message from unknown peer",b),self.emit(b.type,b)}}))})}),this.socket.on("error",function(){self.emit("connect")}),this.socket.on("connecting",function(){a.log("symple:client: connecting"),self.emit("connecting")}),this.socket.on("reconnecting",function(){a.log("symple:client: reconnecting"),self.emit("reconnecting")}),this.socket.on("connect_failed",function(){a.log("symple:client: connect failed"),self.emit("connect_failed"),self.setError("connect")}),this.socket.on("disconnect",function(){a.log("symple:client: disconnect"),self.peer.online=!1,self.emit("disconnect")})},disconnect:function(){this.socket&&this.socket.disconnect()},online:function(){return this.peer.online},join:function(a){this.socket.emit("join",a)},leave:function(a){this.socket.emit("leave",a)},send:function(b,c){if(!this.online())throw"Cannot send messages while offline";if("object"!=typeof b)throw"Message must be an object";if("string"!=typeof b.type&&(b.type="message"),b.id||(b.id=a.randomString(8)),c&&(b.to=c),b.to&&"object"==typeof b.to&&(b.to=a.buildAddress(b.to)),b.to&&"string"!=typeof b.to)throw"Message `to` attribute must be an address string";if(b.from=a.buildAddress(this.peer),b.from===b.to)throw"Message sender cannot match the recipient";a.log("symple:client: sending",b),this.socket.json.send(b)},respond:function(a){this.send(a,a.from)},sendMessage:function(a,b){this.send(a,b)},sendPresence:function(b){b=b||{},b.data?b.data=a.merge(this.peer,b.data):b.data=this.peer,this.send(new a.Presence(b))},sendCommand:function(b,c,d,e){var f=this;b=new a.Command(b,c),this.send(b),d&&this.onResponse("command",{id:b.id},d,function(a){(e||202!==a.status&&406!==a.status)&&f.clear("command",d)})},addCapability:function(a,b){var c=this.peer;c&&("undefined"==typeof b&&(b=!0),"undefined"==typeof c.capabilities&&(c.capabilities={}),c.capabilities[a]=b)},removeCapability:function(a){var b=this.peer;b&&"undefined"!=typeof b.capabilities&&"undefined"!=typeof b.capabilities[a]&&(delete b.capabilities[key],this.sendPresence())},hasCapability:function(a,b){var c=this.roster.get(a);if(c){if("undefined"!=typeof c.capabilities&&"undefined"!=typeof c.capabilities[b])return c.capabilities[b]!==!1;if("undefined"!=typeof c.data&&"undefined"!=typeof c.data.capabilities&&"undefined"!=typeof c.data.capabilities[b])return c.data.capabilities[b]!==!1}return!1},getCapability:function(a,b){var c=this.roster.get(a);if(c){if("undefined"!=typeof c.capabilities&&"undefined"!=typeof c.capabilities[b])return c.capabilities[b];if("undefined"!=typeof c.data&&"undefined"!=typeof c.data.capabilities&&"undefined"!=typeof c.data.capabilities[b])return c.data.capabilities[b]}},setError:function(b,c){a.log("symple:client: fatal error",b,c),this.emit("error",b,c),this.socket&&this.socket.disconnect()},onResponse:function(a,b,c,d){"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]),"undefined"!=typeof c&&c.constructor===Function&&this.listeners[a].push({fn:c,after:d,filters:b})},clear:function(b,c){if(a.log("symple:client: clearing callback",b),"undefined"!=typeof this.listeners[b])for(var d=0;d<this.listeners[b].length;d++)this.listeners[b][d].fn===c&&String(this.listeners[b][d].fn)===String(c)&&(this.listeners[b].splice(d,1),a.log("symple:client: cleared callback",b))},emit:function(){this.emitResponse.apply(this,arguments)||this._super.apply(this,arguments)},emitResponse:function(){var b=arguments[0],c=Array.prototype.slice.call(arguments,1);if("undefined"!=typeof this.listeners[b])for(var d=0;d<this.listeners[b].length;d++)if("object"==typeof this.listeners[b][d]&&"undefined"!==this.listeners[b][d].filters&&a.match(this.listeners[b][d].filters,c[0]))return this.listeners[b][d].fn.apply(this,c),"undefined"!==this.listeners[b][d].after&&this.listeners[b][d].after.apply(this,c),!0;return!1}}),a.Roster=a.Manager.extend({init:function(a){this._super(),this.client=a},add:function(b){if(a.log("symple:roster: adding",b),!b||!b.id||!b.user)throw"Cannot add invalid peer";this._super(b),this.client.emit("addPeer",b)},remove:function(b){b=a.parseAddress(b).id||b;var c=this._super(b);return a.log("symple:roster: removing",b,c),c&&this.client.emit("removePeer",c),c},get:function(b){return peer=this._super(b),peer?peer:this.findOne(a.parseAddress(b))},update:function(a){if(a&&a.id){var b=this.get(a.id);if(b)for(var c in a)b[c]=a[c];else this.add(a)}}}),a.Message=function(a){"object"==typeof a&&this.fromJSON(a),this.type="message"},a.Message.prototype={fromJSON:function(a){for(var b in a)this[b]=a[b]},valid:function(){return this.id&&this.from}},a.Command=function(a){"object"==typeof a&&this.fromJSON(a),this.type="command"},a.Command.prototype={getData:function(a){return this.data?this.data[a]:null},params:function(){return this.node.split(":")},param:function(a){return this.params()[a-1]},matches:function(a){if(xparams=a.split(":"),xparams.length>this.params().length)return!1;for(var b=0;b<xparams.length;b++)if("*"!==xparams[b]&&xparams[b]!==this.params()[b])return!1;return!0},fromJSON:function(a){for(var b in a)this[b]=a[b]},valid:function(){return this.id&&this.from&&this.node}},a.Presence=function(a){"object"==typeof a&&this.fromJSON(a),this.type="presence"},a.Presence.prototype={fromJSON:function(a){for(var b in a)this[b]=a[b]},valid:function(){return this.id&&this.from}},a.Event=function(a){"object"==typeof a&&this.fromJSON(a),this.type="event"},a.Event.prototype={fromJSON:function(a){for(var b in a)this[b]=a[b]},valid:function(){return this.id&&this.from&&this.name}}}(window.Symple=window.Symple||{});